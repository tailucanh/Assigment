<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Danh sách sản phẩm</title>
  <link rel="stylesheet" href="/library/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="/library/fontawesome/css/all.min.css">
  <script src="/library/bootstrap/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="/css/fonts.css">
</head>

<body>
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center">
      <h1 style="text-center pb-2">Danh sách sản phẩm</h1>
      <button class="btn btn-primary shadow-sm " data-bs-toggle="modal" data-bs-target="#modalAdd"><i
          class="fa-solid fa-plus px-2"></i>Thêm sản phẩm</button>
    </div>
    <nav aria-label="breadcrumb" class="mt-3 mb-2">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#"><i class="fa fa-home pe-2"></i>Home</a></li>
        <li class="breadcrumb-item"><a href="#">Products</a> </li>
        <li class="breadcrumb-item active" aria-current="page">List products</li>
      </ol>
    </nav>
    <div class="modal fade" id="modalAdd" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Thêm sản phẩm</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form method="POST" enctype="multipart/form-data">
            <div class="modal-body">
              <div class="align-items-center">
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Ảnh</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <img src="/images/logo.png" class="rounded-circle shadow-4 mb-1"
                      style="width: 90px; height: 90px; object-fit: cover;" alt="Avatar" id="view_image" />
                    <input class="form-control form-control-sm" id="img_product" type="file" name="img_product">
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Tên sản phẩm:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="text" class="form-control" id="name" name="name" required>
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="price" class="col-form-label">Giá:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="number" class="form-control" id="price" name="price" required>
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Loại sản phẩm:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="text" class="form-control" id="type_product" name="type_product" required>
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Khách hàng:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="text" class="form-control" id="client" name="client">
                  </div>
                </div>

                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="description" class="col-form-label">Mô tả:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <textarea class="form-control" id="desc" name="desc"></textarea>
                  </div>
                </div>

              </div>

            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
              <button type="submit" class="btn btn-primary" id="saveProduct">Lưu</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Sửa sản phẩm</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <form method="POST" accept="/edit" enctype="multipart/form-data">
            <div class="modal-body">
              <div class="align-items-center">
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Ảnh</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <img src="/images/logo.png" class="rounded-circle shadow-4 mb-1"
                      style="width: 90px; height: 90px; object-fit: cover;" alt="Avatar" id="view_image" />
                    <input class="form-control form-control-sm" id="img_product" type="file" name="img_product">
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Tên sản phẩm:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="text" class="form-control" id="name" name="name" value="{{product.name}}" required>
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="price" class="col-form-label">Giá:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="number" class="form-control" id="price" name="price" value="{{product.price}}"
                      required>
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Loại sản phẩm:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="text" class="form-control" id="type_product" name="type_product"
                      value="{{product.type_product}}" required>
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="name" class="col-form-label">Khách hàng:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <input type="text" class="form-control" id="client" name="client" value="{{product.client}}">
                  </div>
                </div>

                <div class="row mb-2 align-items-center">
                  <div class="col-lg-4 col-md-12 col-xs-12">
                    <label for="description" class="col-form-label">Mô tả:</label>
                  </div>
                  <div class="col-lg-8 col-md-12 col-xs-12">
                    <textarea class="form-control" id="desc" name="desc" value="{{product.desc}}"></textarea>
                  </div>
                </div>

              </div>

            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
              <button type="submit" class="btn btn-primary" id="saveProduct">Sửa thông tin</button>
            </div>
          </form>

        </div>
      </div>
    </div>

    <div class="row mt-3">
      {{#if listProduct}}
      <table class="table-light table table-striped table-hover shadow-sm ">
        <thead>
          <tr>
            <th>#</th>
            <th>Ảnh</th>
            <th>Tên sản phẩm</th>
            <th>Giá sản phẩm</th>
            <th>Chức năng khác</th>
          </tr>
        </thead>
        <tbody>
          {{#each listProduct}}
          <tr>
            <td>{{@index}}</td>
            <td>
              {{#if imgProduct}}
              <img src="{{imgProduct}}" alt="Avatar" class="rounded-circle" width="60">
              {{else}}
              <img src="/images/logo.png" alt="Avatar" class="rounded-circle" width="60">
              {{/if}}
            </td>

            <td>{{name}}</td>
            <td>{{price}}</td>
            <td>
              <a href="/products/{{id}}" class="btn btn-primary shadow-sm fs-button">Chi tiết</a>
              <a href="/products/edit/{{id}}" class="btn btn-warning  shadow-sm  fs-button" data-bs-toggle="modal"
                data-bs-target="#editModal" data-id="{{id}}" data-name="{{name}}" data-price="{{price}}">Sửa</a>
              <a href="/products/delete/{{id}}" class="btn btn-danger  shadow-sm  fs-button">Xóa</a>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
      {{else}}
      <p class="fs-4 mt-5 text-center text-danger">Chưa có dữ liệu</p>
      {{/if}}



    </div>


  </div>
  <script>
    const imageInput = document.getElementById('img_product');
    const imagePreview = document.getElementById('view_image');

    imageInput.addEventListener('change', function () {
      const file = imageInput.files[0];
      const reader = new FileReader();
      reader.addEventListener('load', function () {
        imagePreview.src = reader.result;
      });

      if (file) {
        reader.readAsDataURL(file);
      }
    });

    $(document).ready(function () {
      $('#exampleModal button.btn-primary').click(function () {
        $.ajax({
          type: "POST",
          url: "/products",
          data: $("#add-product-form").serialize(),
          success: function () {
            // Reload page after saving product
            location.reload();
          }
        });
      });
    });
  </script>

  </script>
</body>

</html>